<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>L-DRAWING</title>
<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
</head>
<body>
	<script>

	//INSERISCO UN GRAFO DI ESEMPIO
	Edge_Graph=[{"sorgente":1,"destinazione":2},
		            {"sorgente":1,"destinazione":3},
		            {"sorgente":3,"destinazione":1},
		            {"sorgente":2,"destinazione":4},
					{"sorgente":4,"destinazione":3},
					{"sorgente":5,"destinazione":4},
					{"sorgente":2,"destinazione":6},
					{"sorgente":4,"destinazione":5},
					{"sorgente":6,"destinazione":2},
					{"sorgente":5,"destinazione":1}];
	Node_Graph=[1,2,3,4,5,6];
	//Node_coordinates =[{"cx":100,"cy":500},{"cx":250,"cy":600},{"cx":350,"cy":400},{"cx":500,"cy":300},{"cx":900,"cy":100},{"cx":700,"cy":800}];
	var Node_coordinates = []
	//diametro nodi
	var diametro_nodi=10;
	var larghezza_bordo = 1000;
	var altezza_bordo = 1000;
	var offset = 100;
	var bodySelection = d3.select ( "body" );

	var svgSelection = bodySelection.append("svg")
		.attr("width", larghezza_bordo)
 		.attr("height", altezza_bordo)
		.style("border", "1px solid black");
	
	function isInRange(arrayUsed, currentValue, soglia){
		for(var i=0; i<arrayUsed.length; i++){
			if(Math.abs(arrayUsed[i] - currentValue)<soglia) return false;
		}
		return true;
	}
	//disegno nodi in ordine dell'array Node_Graph
	var NodeData =[];
	
	var xAlreadyUsed = [];
	var yAlreadyUsed = [];
	for (var i = 0; i < Node_Graph.length; i++) {
		randomX = Math.floor(Math.random()*(larghezza_bordo-offset))
		while(!isInRange(xAlreadyUsed,randomX,50)|| randomX<=diametro_nodi ||randomX>=(larghezza_bordo-diametro_nodi) || randomX < offset){
			randomX = Math.floor(Math.random()*(larghezza_bordo-offset))
		}
		xAlreadyUsed.push(randomX)

		randomY = Math.floor(Math.random()*(altezza_bordo-offset))
		while(!isInRange(yAlreadyUsed,randomY,50)|| randomY<=diametro_nodi || randomY>=(altezza_bordo-diametro_nodi) || randomY < offset){
			randomY = Math.floor(Math.random()*(altezza_bordo-offset))
		}
		yAlreadyUsed.push(randomY)
		NodeData.push({"cx": randomX, "cy": randomY, "radius": diametro_nodi, "color" : "green", "id":Node_Graph[i]});
	}
	for(var i=0;i< Node_coordinates.length;i++){
		NodeData.push({"cx": Node_coordinates[i].cx, "cy": Node_coordinates[i].cy, "radius": diametro_nodi, "color" : "green", "id":Node_Graph[i]});
	}
	
	var circles = svgSelection.selectAll("circle")
    						.data(NodeData)
    						.enter()
    						.append("circle");

	var circleAttributes = circles
							.attr("id", function (d) { return d.id; })
 							.attr("cx", function (d) { return d.cx; })
 							.attr("cy", function (d) { return d.cy; })
 							.attr("r", function (d) { return d.radius; })
 							.style("fill", function (d) { return d.color; });
	
	//inserimento numerazione nodi
	var texts = svgSelection.selectAll("text")
    						.data(NodeData)
    						.enter()
    						.append("text");
	
	var TextAttributes = texts
							.attr("x", function (d) { return d.cx-5; })
							.attr("y", function (d) { return d.cy+5; })
							.text( function (d) { return d.id; })
			                .attr("font-family", "sans-serif")
			                .attr("font-size", "10px")
			                .attr("fill", "black");
	
	//disegno archi
	var sorgente=[];
	var destinazione=[];
	var circles=document.getElementsByTagName("circle");
	for (var j = 0; j < Edge_Graph.length; j++) {
		for (var i = 0; i < (circles.length); i++) {
			if (circles[i].getAttribute("id")==Edge_Graph[j].sorgente){
				sorgente.push({"id":circles[i].getAttribute("id"),"cx":circles[i].getAttribute("cx"),"cy":circles[i].getAttribute("cy")});
			}
			if (circles[i].getAttribute("id")==Edge_Graph[j].destinazione){
				destinazione.push({"id":circles[i].getAttribute("id"),"cx":circles[i].getAttribute("cx"),"cy":circles[i].getAttribute("cy")});
			}
		}
	}	

	var SegmentData = [];
	
	var PuntiRaccordo = new Array();
	
	var cx=parseInt(sorgente[0].cx, 10)+10;
	
	var PolygonData = [];

	for (var i = 0; i < sorgente.length; i++) {
		//se nodo sorgente è minore del nodo destinazione
		if ((sorgente[i].cx < destinazione[i].cx) && (sorgente[i].cy < destinazione[i].cy)){
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10),"y1":parseInt(sorgente[i].cy,10)+diametro_nodi,"x2":(sorgente[i].cx),"y2":parseInt(destinazione[i].cy,10)-diametro_nodi});
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10)+diametro_nodi,"y1":destinazione[i].cy,"x2":parseInt(destinazione[i].cx,10)-diametro_nodi,"y2":destinazione[i].cy});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)-diametro_nodi});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10)+diametro_nodi,"y":parseInt(destinazione[i].cy,10)});
			
			//attributi frecce
			var puntiFreccia = ((parseInt(destinazione[i].cx)-diametro_nodi-10).toString())+","+((parseInt(destinazione[i].cy)-5).toString())+" "+
							   ((parseInt(destinazione[i].cx)-diametro_nodi-10).toString())+","+((parseInt(destinazione[i].cy)+5).toString())+" "+
							   ((parseInt(destinazione[i].cx)-diametro_nodi).toString())+","+((parseInt(destinazione[i].cy)).toString())+" ";
			PolygonData.push({ "fill":  "black", "stroke": "black" ,"stroke-width":"2", "points": puntiFreccia})
			
			//curve di raccordo
			var lineFunction = d3.svg.line()
		 							.x(function(d) { return d.x; })
									.y(function(d) { return d.y; })
									.interpolate("basis");
			//The line SVG Path we draw
			var lineGraph = svgSelection.append("path")
		                        .attr("d", lineFunction(PuntiRaccordo))
		                        .attr("stroke", "black")
		                        .attr("stroke-width", 2)
		                        .attr("fill", "none");
			//svuoto array dei punti per la creazione delle curve di controllo
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
		}
		
		//se nodo sorgente è maggiore del nodo destinazione
		if ((sorgente[i].cx > destinazione[i].cx) && (sorgente[i].cy > destinazione[i].cy)){
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10),"y1":parseInt(sorgente[i].cy,10)-diametro_nodi,"x2":(sorgente[i].cx),"y2":parseInt(destinazione[i].cy,10)+diametro_nodi});
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10)-diametro_nodi,"y1":destinazione[i].cy,"x2":parseInt(destinazione[i].cx,10)+diametro_nodi,"y2":destinazione[i].cy});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)+diametro_nodi});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10)-diametro_nodi,"y":parseInt(destinazione[i].cy,10)});
			
			//attributi frecce
			var puntiFreccia = ((parseInt(destinazione[i].cx)+diametro_nodi+10).toString())+","+((parseInt(destinazione[i].cy)-5).toString())+" "+
							   ((parseInt(destinazione[i].cx)+diametro_nodi+10).toString())+","+((parseInt(destinazione[i].cy)+5).toString())+" "+
							   ((parseInt(destinazione[i].cx)+diametro_nodi).toString())+","+((parseInt(destinazione[i].cy)).toString())+" ";
			PolygonData.push({ "fill":  "black", "stroke": "black" ,"stroke-width":"2", "points": puntiFreccia})
			
			//curve di raccordo
			var lineFunction = d3.svg.line()
		 							.x(function(d) { return d.x; })
									.y(function(d) { return d.y; })
									.interpolate("basis");
			//The line SVG Path we draw
			var lineGraph = svgSelection.append("path")
		                        .attr("d", lineFunction(PuntiRaccordo))
		                        .attr("stroke", "black")
		                        .attr("stroke-width", 2)
		                        .attr("fill", "none");
			//svuoto array dei punti per la creazione delle curve di controllo
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
		}
		if((sorgente[i].cx>destinazione[i].cx)&& (sorgente[i].cy<destinazione[i].cy)){
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10),"y1":parseInt(sorgente[i].cy,10)+diametro_nodi,"x2":(sorgente[i].cx),"y2":parseInt(destinazione[i].cy,10)-diametro_nodi});
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10)-diametro_nodi,"y1":destinazione[i].cy,"x2":parseInt(destinazione[i].cx,10)+diametro_nodi,"y2":destinazione[i].cy});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)-diametro_nodi});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10)-diametro_nodi,"y":parseInt(destinazione[i].cy,10)});

			var puntiFreccia = ((parseInt(destinazione[i].cx)+diametro_nodi+10).toString())+","+((parseInt(destinazione[i].cy)-5).toString())+" "+
							   ((parseInt(destinazione[i].cx)+diametro_nodi+10).toString())+","+((parseInt(destinazione[i].cy)+5).toString())+" "+
							   ((parseInt(destinazione[i].cx)+diametro_nodi).toString())+","+((parseInt(destinazione[i].cy)).toString())+" ";
			PolygonData.push({ "fill":  "black", "stroke": "black" ,"stroke-width":"2", "points": puntiFreccia})
			
			//curve di raccordo
			var lineFunction = d3.svg.line()
		 							.x(function(d) { return d.x; })
									.y(function(d) { return d.y; })
									.interpolate("basis");
			//The line SVG Path we draw
			var lineGraph = svgSelection.append("path")
		                        .attr("d", lineFunction(PuntiRaccordo))
		                        .attr("stroke", "black")
		                        .attr("stroke-width", 2)
		                        .attr("fill", "none");
			//svuoto array dei punti per la creazione delle curve di controllo
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
		}
		if((sorgente[i].cx<destinazione[i].cx)&& (sorgente[i].cy>destinazione[i].cy)){
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10),"y1":parseInt(sorgente[i].cy,10)-diametro_nodi,"x2":(sorgente[i].cx),"y2":parseInt(destinazione[i].cy,10)+diametro_nodi});
			SegmentData.push({"x1":parseInt(sorgente[i].cx,10)+diametro_nodi,"y1":destinazione[i].cy,"x2":parseInt(destinazione[i].cx,10)-diametro_nodi,"y2":destinazione[i].cy});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)+diametro_nodi});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10),"y":parseInt(destinazione[i].cy,10)});
			PuntiRaccordo.push({"x":parseInt(sorgente[i].cx,10)+diametro_nodi,"y":parseInt(destinazione[i].cy,10)});

			var puntiFreccia = ((parseInt(destinazione[i].cx)-diametro_nodi-10).toString())+","+((parseInt(destinazione[i].cy)-5).toString())+" "+
							   ((parseInt(destinazione[i].cx)-diametro_nodi-10).toString())+","+((parseInt(destinazione[i].cy)+5).toString())+" "+
							   ((parseInt(destinazione[i].cx)-diametro_nodi).toString())+","+((parseInt(destinazione[i].cy)).toString())+" ";
			PolygonData.push({ "fill":  "black", "stroke": "black" ,"stroke-width":"2", "points": puntiFreccia})
			
			//curve di raccordo
			var lineFunction = d3.svg.line()
		 							.x(function(d) { return d.x; })
									.y(function(d) { return d.y; })
									.interpolate("basis");
			//The line SVG Path we draw
			var lineGraph = svgSelection.append("path")
		                        .attr("d", lineFunction(PuntiRaccordo))
		                        .attr("stroke", "black")
		                        .attr("stroke-width", 2)
		                        .attr("fill", "none");
			//svuoto array dei punti per la creazione delle curve di controllo
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
			PuntiRaccordo.pop();
		}
	}
	
	//segmenti
	var lines = svgSelection.selectAll("line")
    						.data(SegmentData)
    						.enter()
    						.append("line");
	var lineAttributes = lines
    						.attr("x1", function (d) { return d.x1; })
    						.attr("y1", function (d) { return d.y1; })
    						.attr("x2", function (d) { return d.x2; })
    						.attr("y2", function (d) { return d.y2; })
    						.attr("stroke-width", 2)
							.attr("stroke", "black");
	//curve di raccordo
	var lineFunction = d3.svg.line()
 							.x(function(d) { return d.x; })
							.y(function(d) { return d.y; })
							.interpolate("basis");
	
	var lineGraph = svgSelection.append("path")
                        .attr("d", lineFunction(PuntiRaccordo))
                        .attr("stroke", "black")
                        .attr("stroke-width", 2)
                        .attr("fill", "none");

	var Polygons = svgSelection.selectAll("polygon")
								.data(PolygonData)
								.enter()
								.append("polygon");
	var PolygonAttributes = Polygons
								.attr("points", function (d) { return d.points; })
								.style("fill", function (d) { return d.fill; })
	
	</script>
</body>
</html>
